@using FMS.Core;
@model FMS.Website.Models.TempItemModel

<div class="opt-content clearfloat">
    <h5 class="title-page">Temporary Car</h5>
</div>
<section class="content">
    <div class="wpanel">
        @using (Html.BeginForm("InProgress", "TraTemporary", FormMethod.Post, new { @id = "EditForm" }))
        {
            @Html.AntiForgeryToken()
            <div id="information" class="tab-pane active" role="tabpanel">
                <div class="tab-wrapper">
                    <div aria-multiselectable="true" role="tablist" id="accordion" class="panel-group">
                        <div class="panel panel-default">
                            <div id="headingOne" role="tab" class="panel-heading">
                                <h4 class="panel-title">
                                    <a aria-controls="collapseOne" aria-expanded="true" href="#collapseOne" data-parent="#accordion" data-toggle="collapse">
                                        Information
                                        <i class="fa fa-caret-down"></i>
                                    </a>
                                </h4>
                            </div>
                            <div aria-labelledby="headingOne" role="tabpanel" class="panel-collapse collapse show" id="collapseOne">
                                <div class="panel-body">
                                    <div role="form" class="form-excise">
                                        <div class="box-tools pull-right" style="margin-top:-50px">
                                            <h4>
                                                <label for="" class="control-label">Status:</label>
                                                <label class="control-label">@Html.Raw(Model.Detail.TempStatusName)</label>
                                            </h4>
                                        </div>
                                        <div class="row">
                                            <div class="col-md-6">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h5>Temporary Info</h5>
                                                        <hr />
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            @Html.HiddenFor(model => model.Detail.TraTempId)
                                                            @Html.HiddenFor(model => model.Detail.CreateBy)
                                                            @Html.HiddenFor(model => model.Detail.CreateDate)
                                                            @Html.HiddenFor(model => model.Detail.IsSaveSubmit)
                                                            @Html.HiddenFor(model => model.Detail.IsActive)
                                                            @Html.HiddenFor(model => model.Detail.VehicleType)
                                                            @Html.HiddenFor(model => model.IsPersonalDashboard)
                                                            @Html.HiddenFor(model => model.Detail.EmployeeIdCreator)
                                                            <label class="control-label">Temporary Number</label>
                                                            @Html.TextBoxFor(model => model.Detail.TempNumber, new { @class = "form-control ", @readonly = "readonly" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Reference Number</label>
                                                            @Html.TextBoxFor(model => model.Detail.ReferenceNumber, new { @class = "form-control ", @readonly = "readonly" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Temporary Date</label>
                                                            <div class="input-group date">
                                                                @Html.TextBoxFor(model => model.Detail.CreateDate, "{0:dd-MMM-yyyy}", new { @class = "form-control ", @readonly = "readonly" })
                                                                <span class="input-group-addon">
                                                                    <i class="fa fa-calendar"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Coordinator</label>
                                                            @Html.TextBoxFor(model => model.Detail.CreateBy, new { @class = "form-control ", @readonly = "readonly" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Reason</label>
                                                            @Html.DropDownListFor(model => model.Detail.ReasonId, Model.Detail.ReasonList, "-- Please Select --", new { @class = "form-control", @disabled = "disabled" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Start Date</label>
                                                            <div class="input-group date">
                                                                @Html.TextBoxFor(model => model.Detail.StartPeriod, "{0:dd-MMM-yyyy}", new { @class = "form-control ", @disabled = "disabled" })
                                                                <span class="input-group-addon" id="divStartDate">
                                                                    <i class="fa fa-calendar"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">End Date</label>
                                                            <div class="input-group date" id="divEndDate">
                                                                @Html.TextBoxFor(model => model.Detail.EndPeriod, "{0:dd-MMM-yyyy}", new { @class = "form-control ", @disabled = "disabled" })
                                                                <span class="input-group-addon">
                                                                    <i class="fa fa-calendar"></i>
                                                                </span>
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Location</label>
                                                            @Html.DropDownListFor(model => model.Detail.LocationCity, Model.Detail.LocationCityList, "-- Please Select --", new { @class = "form-control", @disabled = "disabled" })
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6">
                                                <div class="row">
                                                    <div class="col-md-12">
                                                        <h5>Assigned Employee</h5>
                                                        <hr />
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Employee ID</label>
                                                            @Html.DropDownListFor(model => model.Detail.EmployeeId, Model.Detail.EmployeeList, "-- Please Select --", new { @class = "form-control autocomplete", onchange = "GetEmployee()", @disabled = "disabled" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Employee Name</label>
                                                            @Html.TextBoxFor(model => model.Detail.EmployeeName, new { @class = "form-control ", @readonly = "readonly" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Cost Center</label>
                                                            @Html.TextBoxFor(model => model.Detail.CostCenter, new { @class = "form-control ", @readonly = "readonly" })
                                                        </div>
                                                    </div>
                                                    @if (Model.Detail.IsBenefit)
                                                    {
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <label class="control-label">Group Level</label>
                                                                @Html.TextBoxFor(model => model.Detail.GroupLevel, new { @class = "form-control ", @readonly = "readonly" })
                                                            </div>
                                                        </div>
                                                    }
                                                    else
                                                    {
                                                        <div class="col-md-12" style="display:none">
                                                            <div class="form-group">
                                                                <label class="control-label">Group Level</label>
                                                                @Html.TextBoxFor(model => model.Detail.GroupLevel, new { @class = "form-control ", @readonly = "readonly" })
                                                            </div>
                                                        </div>
                                                    }
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Vehicle Type</label>
                                                            @Html.DropDownListFor(model => model.Detail.VehicleType, Model.Detail.VehicleTypeList, "-- Please Select --", new { @class = "form-control", @disabled = "disabled" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Vehicle Usage</label>
                                                            @Html.DropDownListFor(model => model.Detail.VehicleUsage, Model.Detail.VehicleUsageList, "-- Please Select --", new { @class = "form-control", @disabled = "disabled" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Vendor<span class="red">*</span></label>
                                                            @Html.DropDownListFor(model => model.Detail.VendorName, Model.Detail.VendorList, "-- Please Select --", new { @class = "form-control", @disabled = "disabled" })
                                                        </div>
                                                    </div>
                                                    <div class="col-md-12">
                                                        <div class="form-group">
                                                            <label class="control-label">Project</label>
                                                            @Html.DropDownListFor(model => model.Detail.ProjectName, Model.Detail.ProjectList, "-- Please Select --", new { @class = "form-control", @disabled = "disabled" })
                                                        </div>
                                                    </div>
                                                    @if (!Model.Detail.IsBenefit)
                                                    {
                                                        <div class="col-md-12">
                                                            <div class="form-group">
                                                                <label class="control-label">Assigned To</label>
                                                                @Html.TextBoxFor(model => model.Detail.AssignedTo, new { @class = "form-control", @disabled = "disabled" })
                                                            </div>
                                                        </div>
                                                    }
                                                </div>
                                            </div>
                                        </div>
                                        @Html.Partial("_ListVehicle")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div aria-multiselectable="true" role="tablist" id="accordion3" class="panel-group">
                        <div class="panel panel-default">
                            <div id="heading3" role="tab" class="panel-heading">
                                <h4 class="panel-title">
                                    <a aria-controls="collapseThree" aria-expanded="true" href="#collapse3" data-parent="#accordion3" data-toggle="collapse">
                                        Vehicle Detail Information
                                        <i class="fa fa-caret-down"></i>
                                    </a>
                                </h4>
                            </div>
                            <div aria-labelledby="heading3" role="tabpanel" class="panel-collapse collapse show" id="collapse3">
                                <div class="panel-body">
                                    <div role="form" class="form-excise">
                                        <div class="col-md-12">
                                            <div class="form-group">
                                                <a id="btnUploadCar" href="#" class="btn btn-primary" onclick="UploadTemp(@Model.Detail.TraTempId)"><i class="glyphicon glyphicon-upload"></i> Upload From Vendor</a>
                                            </div>
                                        </div>
                                        @Html.Partial("_ListVehicleFromVendor")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div aria-multiselectable="true" role="tablist" id="accordion5" class="panel-group">
                        <div class="panel panel-default">
                            <div id="heading5" role="tab" class="panel-heading">
                                <h4 class="panel-title">
                                    <a aria-controls="collapseFive" aria-expanded="true" href="#collapse5" data-parent="#accordion5" data-toggle="collapse">
                                        Workflow History
                                        <i class="fa fa-caret-down"></i>
                                    </a>
                                </h4>
                            </div>
                            <div aria-labelledby="heading5" role="tabpanel" class="panel-collapse collapse" id="collapse5">
                                <div class="panel-body">
                                    <div role="form" class="form-excise">
                                        @Html.Partial("_WorkflowHistoryTable")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div aria-multiselectable="true" role="tablist" id="accordion6" class="panel-group">
                        <div class="panel panel-default">
                            <div id="heading6" role="tab" class="panel-heading">
                                <h4 class="panel-title">
                                    <a aria-controls="collapseSix" aria-expanded="true" href="#collapse6" data-parent="#accordion6" data-toggle="collapse">
                                        Change History
                                        <i class="fa fa-caret-down"></i>
                                    </a>
                                </h4>
                            </div>
                            <div aria-labelledby="heading6" role="tabpanel" class="panel-collapse collapse" id="collapse6">
                                <div class="panel-body">
                                    <div role="form" class="form-excise">
                                        @Html.Partial("_ChangesLog")
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="row col-md-12">
                <input type="submit" value="Save" class="btn btn-primary" id="btnSaveProgress" />
                <input type="button" value="Cancel" class="btn btn-primary" onclick="CancelTemp(@Model.Detail.TraTempId)" />
                <a href="@Url.Action(Model.IsPersonalDashboard ? "PersonalDashboard" : "Index", "TraTemporary")" class="btn btn-default">Back</a>
            </div>
        }
    </div>
</section>
<div id="uploadmodal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Upload Data From Vendor</h4>
            </div>
            @using (Html.BeginForm("", "TraTemporary"))
            {
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                <label class="control-label">Select File</label>
                                <div class="input-group">
                                    <input type="file" id="itemExcelFile" name="itemExcelFile" class="form-control rounded-0 rounded-left" />
                                </div>
                                <label id="messageErrorId" style="display:none"></label>
                                <div>
                                    Download template <a href="~/files_upload/excelVendor.xlsx">here</a>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    @Html.HiddenFor(model => model.IsPersonalDashboard)
                    <input type="button" class="btn btn-grey" data-dismiss="modal" value="Close" />
                    <input type="button" class="btn btn-danger" value="OK" id="btnUploadTemp" />
                </div>
            }
        </div>
    </div>
</div>
<div id="cancelmodal" class="modal fade in" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Cancel document ?</h4>
            </div>
            @using (Html.BeginForm("CancelTemp", "TraTemporary"))
            {
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="form-group">
                                @Html.HiddenFor(model => model.IsPersonalDashboard)
                                <input type="hidden" name="TraTempCancelId" id="TraTempCancelId">
                                <label class="control-label">Select Remark</label>
                                @Html.DropDownList("RemarkId", Model.RemarkList, "Select", new { @class = "form-control SelectPicker", @required = "required" })
                            </div>
                        </div>
                    </div>

                </div>
                <div class="modal-footer">
                    <input type="button" class="btn btn-grey" data-dismiss="modal" value="Close" />
                    <input type="submit" class="btn btn-danger" value="OK" id="btnConfirmCancel" />
                </div>
            }
        </div>
    </div>
</div>
<script src="~/Scripts/tempscript.js"></script>
<script type="text/javascript">
    var uploaditems = [];

    $(document).ready(function () {
        $('#btnUploadTemp').click(function () {
            uploadXmlFile();
        });
    });

    function CancelTemp(value) {
        $('#TraTempCancelId').val(value);
        $('#cancelmodal').modal('show');
    }

    function UploadTemp(value) {
        $('#uploadmodal').modal('show');
    }

    function uploadXmlFile() {
        var postUrl = '@Url.Action("UploadFile", "TraTemporary")';
        var fileName = $('[name="itemExcelFile"]').val().trim();
        var pos = fileName.lastIndexOf('.');
        var extension = (pos <= 0) ? '' : fileName.substring(pos);
        if (extension != '.xlsx' && extension != '.csv') {
            alert('Please browse a correct excel file to upload');
            return false;
        }

        var formData = new FormData();
        var totalFiles = document.getElementById("itemExcelFile").files.length;

        for (var i = 0; i < totalFiles; i++) {
            var file = document.getElementById("itemExcelFile").files[i];
            formData.append("itemExcelFile", file);
        }

        formData.append("Detail_TraTempId", '@Model.Detail.TraTempId');

        $.ajax({
            type: "POST",
            url: postUrl,
            data: formData,
            dataType: 'html',
            contentType: false,
            processData: false,

            success: function (response) {
                $('#tb-body-select-vehicle-from-vendor').html('');
                uploaditems = JSON.parse(response);
                var error = "";
                for (var i = 0; i < uploaditems.length; i++) {
                    var tr = '<tr>' +
                    '<td><input type="hidden" name="Detail.PoliceNumberVendor" id="Detail_PoliceNumberVendor" value="' + uploaditems[i].PoliceNumber + '"></input>' + uploaditems[i].PoliceNumber + '</td>' +
                    '<td><input type="hidden" name="Detail.ManufacturerVendor" id="Detail_ManufacturerVendor" value="' + uploaditems[i].Manufacturer + '"></input>' + uploaditems[i].Manufacturer + '</td>' +
                    '<td><input type="hidden" name="Detail.ModelsVendor" id="Detail_ModelsVendor" value="' + uploaditems[i].Models + '"></input>' + uploaditems[i].Models + '</td>' +
                    '<td><input type="hidden" name="Detail.SeriesVendor" id="Detail_SeriesVendor" value="' + uploaditems[i].Series + '"></input>' + uploaditems[i].Series + '</td>' +
                    '<td><input type="hidden" name="Detail.BodyTypeVendor" id="Detail_BodyTypeVendor" value="' + uploaditems[i].BodyType + '"></input>' + uploaditems[i].BodyType + '</td>' +
                    '<td><input type="hidden" name="Detail.VendorNameVendor" id="Detail_VendorNameVendor" value="' + uploaditems[i].VendorName + '"></input>' + uploaditems[i].VendorName + '</td>' +
                    '<td><input type="hidden" name="Detail.ColorVendor" id="Detail_ColorVendor" value="' + uploaditems[i].Color + '"></input>' + uploaditems[i].Color + '</td>' +
                    '<td><input type="hidden" name="Detail.StartPeriodVendor" id="Detail_StartPeriodVendor" value="' + uploaditems[i].StartPeriodValue + '"></input>' + uploaditems[i].StartPeriodName + '</td>' +
                    '<td><input type="hidden" name="Detail.EndPeriodVendor" id="Detail_EndPeriodVendor" value="' + uploaditems[i].EndPeriodValue + '"></input>' + uploaditems[i].EndPeriodName + '</td>' +
                    '<td><input type="hidden" name="Detail.PoNumberVendor" id="Detail_PoNumberVendor" value="' + uploaditems[i].PoNumber + '"></input>' + uploaditems[i].PoNumber + '</td>' +
                    '<td>' + uploaditems[i].MessageError + '</td>' +
                    '<input type="hidden" name="Detail.ChasisNumberVendor" id="Detail_ChasisNumberVendor" value="' + uploaditems[i].ChasisNumber + '"></input>' +
                    '<input type="hidden" name="Detail.EngineNumberVendor" id="Detail_EngineNumberVendor" value="' + uploaditems[i].EngineNumber + '"></input>' +
                    '<input type="hidden" name="Detail.IsAirBagVendor" id="Detail_IsAirBagVendor" value="' + uploaditems[i].IsAirBag + '"></input>' +
                    '<input type="hidden" name="Detail.TransmissionVendor" id="Detail_TransmissionVendor" value="' + uploaditems[i].Transmission + '"></input>' +
                    '<input type="hidden" name="Detail.BrandingVendor" id="Detail_BrandingVendor" value="' + uploaditems[i].Branding + '"></input>' +
                    '<input type="hidden" name="Detail.PurposeVendor" id="Detail_PurposeVendor" value="' + uploaditems[i].Purpose + '"></input>' +
                    '<input type="hidden" name="Detail.PoLineVendor" id="Detail_PoLineVendor" value="' + uploaditems[i].PoLine + '"></input>' +
                    '<input type="hidden" name="Detail.IsVatVendor" id="Detail_IsVatVendor" value="' + uploaditems[i].IsVat + '"></input>' +
                    '<input type="hidden" name="Detail.IsRestitutionVendor" id="Detail_IsRestitutionVendor" value="' + uploaditems[i].IsRestitution + '"></input>' +
                    '</tr>';
                    $('#tb-body-select-vehicle-from-vendor').append(tr);
                    error += uploaditems[i].MessageErrorStopper;
                }

                if (error.trim() == "") {
                    $("#btnSaveProgress").css("display", "");
                }
                else {
                    $("#btnSaveProgress").css("display", "none");
                }
                
                $('#uploadmodal').modal('hide');
            }
        });
    };
</script>
