

ALTER VIEW [dbo].[View_EPAF_CTF]
AS
select 
'Promotion' as ACTION_TYPE,
EMPLID,
NAME as NAME_FORMAL,
COST_CENTER as CC,
EFFDT as EFFDATE,
GRADE_LVL as GROUP_LEVEL,
'SYSTEM' as LASTUPDOPRID
 FROM [PSFT_FMS]..SYSADM.PS_HMS_JOB_FLEET_VW
 join (select EMPLOYEE_ID,GROUP_LEVEL from MST_FLEET group by EMPLOYEE_ID,GROUP_LEVEL) as a on a.EMPLOYEE_ID = EMPLID
where ACTION in ('PRO') and a.GROUP_LEVEL <> GRADE_LVL 

UNION
select 
(case ACTION_REASON  
WHEN 'RES' THEN 'Resignation'
ELSE 'Terminate by Company' END) as ACTION_TYPE,
EMPLID,
NAME as NAME_FORMAL,
COST_CENTER as CC,
EFFDT as EFFDATE,
GRADE_LVL as GROUP_LEVEL,
'SYSTEM' as LASTUPDOPRID

from [PSFT_FMS]..SYSADM.PS_HMS_JOB_FLEET_VW 
where ACTION in ('TER') and 
EMPLID  in (
select employee_id from mst_employee)
UNION
select (case ACTION_REASON  
WHEN 'STA' THEN 'STA Out'
ELSE 'IA Out' END) as ACTION_TYPE,
EMPLID,
NAME as NAME_FORMAL,
COST_CENTER as CC,
EFFDT as EFFDATE,
GRADE_LVL as GROUP_LEVEL,

'SYSTEM' as LASTUPDOPRID
from [PSFT_FMS]..SYSADM.PS_HMS_JOB_FLEET_VW 
where ACTION = 'TAS' and ACTION_REASON in ('STA','IA') and 
EMPLID  in (
select employee_id from mst_employee);





GO


